# 💨 风机叶片损伤检测系统

> Wind Turbine Blade Damage Detection System
> 
> 基于深度学习的智能风机叶片损伤识别与检测平台

---

## ⚠️ 重要提示

**使用说明：**
- 第一次双击打开 `.exe` 文件需要等待 **2分钟左右**，适配相关文件
- 需将模型文件 `.pt` 移动到系统目录下

**默认账户：**
- 用户名：`admin`
- 密码：`admin123`

---

## ✨ 系统简介

风机叶片损伤检测系统是一个功能完善、界面美观的AI目标检测平台，专为风力发电机叶片损伤识别设计。系统集成了用户管理、模型加载、实时检测、批量处理等完整功能，支持图片、视频、本地摄像头和网络摄像头多种输入源。

### 核心特性

- 🔐 **完整的用户系统** - 登录注册、密码加密、记住密码
- 🎯 **多源检测支持** - 图片/批量/视频/本地摄像头/网络摄像头
- 📊 **实时可视化** - 原图与检测结果对比、JSON数据展示
- 💾 **智能保存** - 自动递增文件夹、图片+JSON批量保存
- ⚡ **性能优化** - GPU加速、网络流低延迟优化（<500ms）
- 🎨 **现代化UI** - 蓝白主题、玻璃态效果、自适应布局

---

## 📦 快速开始

### EXE程序（推荐）

#### 1. 双击运行
```
猪只计数系统.exe
```

#### 2. 首次启动
- ⏱️ 等待 2 分钟（首次需要解压临时文件）
- 📁 确保模型文件在系统目录

#### 3. 登录系统
- 输入默认账户：`admin` / `admin123`
- 或点击"立即注册"创建新账户
- 可勾选"记住账号"/"记住密码"

#### 4. 开始检测
- 点击"使用默认模型"加载模型
- 选择检测源（图片/视频/摄像头）
- 查看实时检测结果
- 保存检测数据


## 🎯 主要功能

### 🔐 用户管理系统

- **登录/注册** - 独立的登录注册页面，现代化设计
- **密码加密** - SHA256加密存储，保障安全
- **记住密码** - 可选记住账号和密码，便捷登录
- **用户信息** - 主界面显示当前用户，支持退出登录
- **多用户支持** - 支持创建和管理多个账户

### 📷 图片检测

#### 单图片检测
- 选择单张图片进行检测
- 实时调节置信度阈值
- 自动重新检测
- 显示原图与检测结果对比
- JSON数据实时展示

#### 批量图片检测
- 一次选择多张图片（Ctrl/Shift多选）
- 实时显示处理进度
- 自动保存所有结果
- 生成汇总JSON报告
- 智能递增文件夹（output_1, output_2...）

### 🎬 视频检测

- **完整视频处理** - 逐帧检测并保存
- **进度显示** - 实时显示处理进度
- **结果保存** - 保存检测后的完整视频
- **逐帧JSON** - 每一帧的检测数据
- **最后一帧预览** - 显示最后一帧的检测情况

### 📹 实时摄像头检测

#### 本地摄像头
- 一键启用本地摄像头
- 实时检测显示
- 可保存当前帧

#### 网络摄像头（RTSP/HTTP）
- 支持RTSP、HTTP、HTTPS协议
- 低延迟优化（<500ms）
- 支持海康、大华等主流品牌
- 实时流检测
- grab+retrieve快速丢帧技术

### 📊 实时预览

- **对比显示** - 左侧原图，右侧检测结果
- **JSON数据** - 实时显示检测数据（类别、坐标、置信度）
- **统计信息** - 检测数量、类别分布
- **置信度调节** - 拖动滑块实时调整并重新检测
- **日志记录** - 详细的操作日志

### 💾 结果保存

#### 保存选项
- **保存图片/视频** - 保存检测结果的图像或视频
- **保存JSON** - 保存检测数据的JSON文件
- **保存全部** - 同时保存图片和JSON

#### 批量保存
- 自动创建 `output_N` 文件夹（N自动递增）
- 图片保存在 `images/` 子文件夹
- JSON保存在根目录
- 永不覆盖已有数据

### ⚙️ 高级功能

- **置信度调节** - 实时调整检测阈值
- **模型切换** - 支持多种YOLO模型格式
- **GPU加速** - 自动检测并使用GPU
- **自适应布局** - 支持不同分辨率屏幕
- **低延迟优化** - 网络摄像头延迟<500ms

---

## 📁 文件结构

### 核心文件
```
猪只计数系统.exe          # 主程序（EXE分发版）
pyqt5_detection_viewer.py # 主程序（Python源码）
login_window.py           # 登录注册模块
best.pt                   # 风机叶片检测模型
bg.jpg                    # 登录背景图片
```

### 配置文件（自动生成）
```
users.json                # 用户账户数据（加密）
remember.json             # 记住的账号密码
```

```

---

## 🚀 详细使用说明

### 1️⃣ 登录系统

#### 首次使用
1. 运行程序后显示登录界面
2. 点击右侧"✨ 创建账户"
3. 填写用户名、邮箱、密码
4. 点击"创建账户"
5. 自动跳转到登录页面
6. 输入账户密码登录

#### 使用默认账户
- 用户名：`admin`
- 密码：`admin123`
- 可勾选"记住账号"和"记住密码"

### 2️⃣ 加载模型

#### 使用默认模型
```
点击：使用默认模型 (best.pt)
```

#### 选择自定义模型
```
点击：选择模型权重
→ 选择 .pt / .onnx / .engine 模型文件
```

### 3️⃣ 图片检测

#### 单图片检测
```
点击：📷 图片检测 ▼
→ 选择：🖼️ 单图片检测
→ 选择图片文件
→ 查看检测结果
→ 拖动置信度滑块可实时调整
```

#### 批量图片检测
```
点击：📷 图片检测 ▼
→ 选择：📚 批量图片检测
→ 按Ctrl/Shift选择多张图片
→ 等待检测完成
→ 点击"保存结果▼" → "保存全部"
→ 选择保存目录
→ 自动创建 output_N 文件夹
```

### 4️⃣ 视频检测

#### 视频文件检测
```
点击：🎥 视频流检测 ▼
→ 选择：🎬 选择视频文件
→ 选择视频（MP4/AVI/MOV/MKV）
→ 等待逐帧处理
→ 显示最后一帧结果
→ 保存检测后的完整视频
```

#### 本地摄像头
```
点击：🎥 视频流检测 ▼
→ 选择：📹 本地摄像头
→ 实时检测显示
→ 可保存当前帧
→ 点击"停止播放"结束
```

#### 网络摄像头
```
点击：🎥 视频流检测 ▼
→ 选择：🌐 网络摄像头...
→ 输入RTSP/HTTP地址
  例如：rtsp://admin:password@192.168.1.100:554/stream
→ 低延迟实时检测
→ 点击"停止播放"断开
```

### 5️⃣ 保存结果

```
点击：保存结果 ▼
├── 💾 保存图片/视频  - 保存检测图像或视频文件
├── 📄 保存JSON       - 保存检测数据
└── 📦 保存全部        - 同时保存图片和JSON
```

**批量模式特殊说明：**
- 选择保存目录后自动创建 `output_N` 文件夹
- 所有图片保存在 `output_N/images/`
- 汇总JSON保存为 `output_N/batch_results.json`

### 6️⃣ 退出登录

```
点击右上角：👤 用户名 [退出]
→ 确认退出
→ 返回登录界面
→ 可切换其他账户
```

---

## 📊 输出结构

### 单图片检测
```
detection_result.jpg      # 检测结果图片
detection_result.json     # 检测数据
```

### 批量图片检测
```
output_1/
├── images/                    # 所有检测结果图片
│   ├── image1_result.jpg
│   ├── image2_result.jpg
│   └── ...
└── batch_results.json         # 汇总JSON数据

output_2/
├── images/
└── batch_results.json
```

### 视频检测
```
detection_video.mp4            # 检测后的视频
video_results.json             # 所有帧的检测数据
{
  "video_info": {
    "total_frames": 300,
    "fps": 25.0,
    "duration": 12.0,
    "total_detections": 450
  },
  "frames": [
    {
      "frame_number": 1,
      "timestamp": 0.04,
      "detections": {...}
    },
    ...
  ]
}
```

---

## 🌐 网络摄像头配置

### 支持的协议
- RTSP（推荐）
- HTTP/HTTPS

### URL格式

#### 通用格式
```
rtsp://用户名:密码@IP地址:端口/路径
```

#### 海康威视
```
主码流: rtsp://admin:password@192.168.1.64:554/Streaming/Channels/101
子码流: rtsp://admin:password@192.168.1.64:554/Streaming/Channels/102
```

#### 大华摄像头
```
rtsp://admin:password@192.168.1.108:554/cam/realmonitor?channel=1&subtype=0
```

#### HTTP摄像头
```
http://192.168.1.100:8080/video.mjpg
```

### 低延迟优化

系统采用以下技术降低网络延迟：
- TCP传输协议
- 无缓冲模式
- grab+retrieve快速丢帧
- 最小缓冲区设置

**实测延迟：< 500ms**

---

## 🎨 界面功能说明

### 左侧控制面板

#### 用户信息区
```
👤 用户名  [退出]
```

#### 模型加载
```
- 模型权重路径显示
- 选择模型权重
- 使用默认模型
```

#### 置信度调节
```
- 拖动滑块调整阈值（0.1-0.9）
- 实时重新检测（图片模式）
```

#### 检测功能
```
📷 图片检测 ▼
  ├── 🖼️ 单图片检测
  └── 📚 批量图片检测

🎥 视频流检测 ▼
  ├── 🎬 选择视频文件
  ├── 📹 本地摄像头
  └── 🌐 网络摄像头...

停止播放
保存结果 ▼
```

#### 系统状态
```
- 模型加载状态
- 操作日志记录
```

### 右侧预览面板

#### 上半部分：图像对比
```
┌─────────────┬─────────────┐
│   原图      │  检测结果    │
└─────────────┴─────────────┘
```

#### 下半部分：JSON数据
```
┌─────────────────────────────┐
│ 检测数据 (JSON)              │
│ {                           │
│   "total_count": 3,         │
│   "class_counts": {...},    │
│   "detections": [...]       │
│ }                           │
└─────────────────────────────┘
```

---

## 💻 系统要求

### 运行环境（EXE版本）
- **操作系统**: Windows 7/8/10/11 (64位)
- **内存**: 4GB+ RAM（推荐8GB+）
- **显卡**: 可选 NVIDIA GPU（检测加速）
- **硬盘**: 2GB+ 可用空间

### 开发环境（Python版本）
- **Python**: 3.8 或更高版本
- **依赖包**: 见 `requirements.txt`
- **Conda**: 可选，推荐使用虚拟环境

---

## 🔧 技术栈

- **GUI框架**: PyQt5
- **图像处理**: OpenCV
- **深度学习**: PyTorch
- **目标检测**: Ultralytics YOLO
- **数据处理**: NumPy, JSON
- **用户认证**: hashlib (SHA256)

---

## 📖 功能详解

### 置信度调节

**实时调节功能：**
- 检测完图片后，拖动置信度滑块
- 系统自动使用新阈值重新检测
- 无需重新选择图片
- 快速找到最佳检测阈值

**应用场景：**
- 检测结果太多 → 提高阈值
- 检测结果太少 → 降低阈值
- 对比不同阈值效果

### 批量检测工作流

1. **选择图片** - 多选需要检测的图片
2. **自动检测** - 后台批量处理，显示进度
3. **查看结果** - 显示最后一张的检测效果
4. **保存结果** - 选择目录后自动保存所有

**输出结构：**
```
output_1/
├── images/              # 所有检测图片
│   ├── blade1_result.jpg
│   ├── blade2_result.jpg
│   └── ...
└── batch_results.json   # 汇总数据
  {
    "batch_info": {
      "total_images": 50,
      "success": 48,
      "failed": 2,
      "confidence_threshold": 0.5
    },
    "results": [...]
  }
```

### 视频检测详解

**处理流程：**
1. 选择视频文件
2. 获取视频属性（FPS、分辨率、总帧数）
3. 逐帧检测并标注
4. 保存检测后的视频
5. 生成完整的逐帧JSON数据

**JSON数据格式：**
```json
{
  "video_info": {
    "filename": "blade_video.mp4",
    "total_frames": 300,
    "fps": 25.0,
    "duration": 12.0,
    "resolution": "1920x1080",
    "total_detections": 450
  },
  "frames": [
    {
      "frame_number": 1,
      "timestamp": 0.04,
      "detections": {
        "total_count": 2,
        "class_counts": {"damage": 2},
        "detections": [
          {
            "class_id": 0,
            "class_name": "damage",
            "confidence": 0.92,
            "bbox": {
              "x1": 120, "y1": 80,
              "x2": 250, "y2": 400,
              "width": 130, "height": 320
            }
          }
        ]
      }
    }
  ]
}
```

---

## 🎯 使用技巧

### 提高检测准确率
- 使用高分辨率图片
- 调整置信度阈值
- 确保光照充足
- 图片清晰无模糊

### 批量处理优化
- 图片大小尽量一致
- 使用GPU加速
- 适当提高置信度阈值
- 避免处理过大文件

### 网络摄像头优化
- 使用有线网络
- 使用子码流（分辨率较低）
- 降低帧率
- 检查网络带宽

---

## ⚠️ 注意事项

### 首次启动EXE
- 需要等待 **2分钟** 左右
- 系统在解压临时文件
- 请耐心等待，不要重复点击

### 模型文件位置
- EXE版本：模型已打包在程序中
- Python版本：需要模型文件在程序目录
- 可通过"选择模型权重"加载其他模型

### 内存占用
- 单图片检测：约2-4GB
- 批量检测：约4-8GB
- 视频检测：约4-8GB
- GPU模式会占用显存

### 数据安全
- 用户密码SHA256加密存储
- "记住密码"使用明文本地存储
- 不建议在公共电脑使用"记住密码"

---

## 🐛 常见问题

### Q1: 程序启动慢？
**A:** 首次启动EXE需要解压文件（2分钟），后续启动会快很多。

### Q2: 检测结果不准确？
**A:** 调节置信度阈值，或更换更适合的模型。

### Q3: 批量检测很慢？
**A:** 
- 使用GPU加速
- 降低图片分辨率
- 提高置信度阈值

### Q4: 网络摄像头延迟高？
**A:**
- 使用有线网络
- 使用子码流
- 检查网络带宽

### Q5: 视频检测失败？
**A:**
- 确保视频格式为MP4/AVI
- 检查视频文件是否损坏
- 尝试重新编码视频

### Q6: 忘记密码？
**A:** 删除 `users.json` 文件，系统会重新创建默认账户。

---

## 📈 性能优化

### GPU加速
系统自动检测NVIDIA GPU：
- 有GPU：自动使用CUDA加速
- 无GPU：使用CPU模式

### 内存优化
- 逐帧处理视频（不占用大量内存）
- 批量检测时自动释放内存
- 智能缓存管理

### 网络优化
- FFMPEG后端支持
- 无缓冲模式
- TCP/UDP可选
- 快速丢帧技术

---

## 🔄 版本更新

### Version 1.0 (当前)
- ✅ 完整的用户登录注册系统
- ✅ 单图片/批量/视频检测
- ✅ 本地/网络摄像头支持
- ✅ 记住账号密码功能
- ✅ 实时预览与数据展示
- ✅ 智能保存系统
- ✅ 现代化UI设计
- ✅ 自适应布局
- ✅ 下拉菜单优化

---

## 📧 技术支持

如遇问题或有建议，欢迎反馈！

### 问题反馈时请提供
1. 操作系统版本
2. Python版本（如使用Python运行）
3. 详细错误信息截图
4. 操作步骤

---

## 📄 许可证

本项目基于 Ultralytics 开源协议

---

## 🎉 特色亮点

### 🎨 现代化设计
- 蓝白配色主题
- 玻璃态透明效果
- 渐变发光效果
- 流畅动画过渡

### 📱 响应式布局
- 自动适配不同分辨率
- 支持4K/2K/1080P/768P
- 动态调整控件大小
- 最小尺寸保护

### 🔐 安全可靠
- 密码加密存储
- 多用户隔离
- 数据本地化
- 无需联网

### ⚡ 高性能
- GPU加速支持
- 低延迟优化
- 智能缓存
- 进度实时显示

---

**感谢使用风机叶片损伤检测系统！** 💨✨

**开始检测：双击程序 → 登录 → 加载模型 → 开始检测！** 🚀
